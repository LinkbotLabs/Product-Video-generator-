from flask import Flask, render_template, request, session, redirect, url_for, flash
import os

app = Flask(__name__)
app.secret_key = os.urandom(16)  # or your existing secret

@app.route("/", methods=["GET", "POST"])
def login():
    if request.method == "POST":
        username = request.form.get("username")
        password = request.form.get("password")
        mode = request.form.get("mode")  # "demo" or "full"

        if mode == "demo":
            # Demo mode does not require password
            session["user_type"] = "demo"
            flash("Demo mode activated!", "info")
            return redirect(url_for("dashboard"))

        elif mode == "full":
            # Full mode requires password from Render environment variable
            full_password = os.environ.get("FULL_MODE_PASSWORD")
            if not full_password:
                flash("Full mode password not set in environment!", "error")
                return redirect(url_for("login"))

            if password == full_password:
                session["user_type"] = "full"
                session["full_uses"] = 0
                flash("Full mode activated! You can now generate videos.", "success")
                return redirect(url_for("dashboard"))
            else:
                flash("Incorrect Full Mode password.", "error")
                return redirect(url_for("login"))

        else:
            flash("Unknown login mode.", "error")
            return redirect(url_for("login"))

    return render_template("login.html")
